<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/Sudoku logo.png" type="image/x-icon">
    <title>Sudoku - Perfil</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Potta+One&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style/dashboard.css">
</head>

<body onload="atualizarpagina()">
    <nav>
        <div class="nav-container">
            <a href="Login.html" class="nav-logo">
                <img src="assets/Sudoku logo blue mode.png" alt="logo-sudoku" class="logo">
            </a>
            <div class="dark-mode-toggle" id="dark-mode-toggle">
                <i class="bx bxs-sun"></i>
                <i class="bx bxs-moon"></i>
            </div>
        </div>

    </nav>
    <div class="dashboard-screen">
        <div class="dashboard-pai">
            <div class="container-nav-dash">
                <div class="icon-perfil">
                    <img src="assets/Perfil-Icon.png" alt="Perfil-Icon" class="icon-image">
                </div>
                <div class="info-txts-perfil">
                    <div class="nome-user" id="nome_user"></div>
                    <div class="sair_conta"><u>Sair da conta</u></div>
                </div>
                <div class="button-box">
                    <button class="button-style" id="button_redirect_jogo">Voltar para Jogar</button>
                </div>
            </div>
            <div class="elements-dashboard">
                <div class="kpi-container">
                    <div class="kpi-box">
                        <div class="kpi-element">
                            <h3>Jogos Finalizados</h3>
                            <div class="kpi-content" id="kpi_jogos_finalizados"></div>
                        </div>
                    </div>
                    <div class="kpi-box">
                        <div class="kpi-element">
                            <h3>Média de erros por jogo</h3>
                            <div class="kpi-content" id="kpi_media_erro"></div>
                        </div>
                    </div>
                    <div class="kpi-box">
                        <div class="kpi-element">
                            <h3>Tempo de jogo total</h3>
                            <div class="kpi-content" id="kpi_tempo_total">220h</div>
                        </div>
                    </div>
                </div>
                <div class="grafico-dinamico">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script src="js/darkmode.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script>
    var tempo_total_de_jogo = 0;
    var kpi_tempo = '';
    document.querySelector('#button_redirect_jogo').addEventListener('click', () => {
        window.location.href = 'sudoku.html';
    });
    document.querySelector('.sair_conta').addEventListener("click", () => {
        window.location.href = 'index.html';
    });
    function atualizarpagina() {
        nome_user.innerHTML = sessionStorage.username;
        var idplayer = sessionStorage.ID_USUARIO;
        //
        fetch(`/usuarios/obterjogoswins/${idplayer}`, {
            method: "GET",
            headers: {
                "Content-type": "application/json"
            }
        })
            .then(data => {
                return data.json();
            })
            .then(data => {
                console.log("Dado puxado com sucesso:", data);
                sessionStorage.setItem('JOGOS_FINALIZADOS', data[0].jogosf);
            })
            .catch(error => {
                console.log("Erro no catch:", error);
            })
        //
        fetch(`/usuarios/obtermediaerro/${idplayer}`, {
            method: "GET",
            headers: {
                "Content-type": "application/json"
            }
        })
            .then(data => {
                return data.json();
            })
            .then(data => {
                console.log("Dado puxado com sucesso:", data);
                sessionStorage.setItem('MEDIA_ERROS', data[0].media_erros);
            })
            .catch(error => {
                console.log("Erro no catch:", error);
            })

        //
        fetch(`/usuarios/obtertempodejogo/${idplayer}`, {
            method: "GET",
            headers: {
                "Content-type": "application/json"
            }
        })
            .then(data => {
                return data.json();
            })
            .then(data => {
                console.log("Dado puxado com sucesso:", data);
                sessionStorage.setItem('TEMPO_CARREIRA', data[0].tempo_total);
                converterhoras();
            })
            .catch(error => {
                console.log("Erro no catch:", error);
            })

        var plotar_kpis = setInterval(() => {
            kpi_jogos_finalizados.innerHTML = sessionStorage.JOGOS_FINALIZADOS;
            kpi_media_erro.innerHTML = sessionStorage.MEDIA_ERROS;
            if (horas < 1) {
                kpi_tempo_total.innerHTML = `<1h`
            } else {
                if (minutos == 0) {
                    kpi_tempo_total.innerHTML = `${horas}h`
                }
                else {
                    kpi_tempo_total.innerHTML = `${horas}h${minutos}m`
                }
            }
        }, 500);
        setTimeout(() => {
            clearInterval(plotar_kpis);
        }, 1000);
    }
    var minutos = 0;
    var horas = 0;
    function converterhoras() {
        var segundos_input = sessionStorage.TEMPO_CARREIRA;
        var segundos = segundos_input;
        minutos = 0
        horas = 0;
        while (1) {
            while (segundos >= 60) {
                segundos -= 60;
                minutos++;
            }
            while (minutos >= 60) {
                minutos -= 60;
                horas++;
            }
            break;
        }

    }
    const ctx = document.getElementById("myChart")
    const grafico = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Fácil', 'Médio', 'Difícil'],
            datasets: [{
                data: [10, 20, 5],
                backgroundColor: ['#4CAF50', '#FFC107', '#F44336'],
                borderColor: '#00aeef',
                borderWidth: 10
            }]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Dificuldade das partidas jogadas',
                    color: '#ffffff',
                    font: {
                        size: 25,
                        family: 'Arial',
                        weight: 'bold'
                    },
                    padding: {
                        top: 10,
                        bottom: 10
                    }
                },
                legend: {
                    position: 'left',
                    labels: {
                        color: '#ffffff'
                    }
                },
                datalabels: {
                    color: '#fff',
                    font: {
                        weight: 'bold',
                        size: 26
                    }
                }
            },
            cutout: '60%'
        },
        plugins: [ChartDataLabels]
    });


</script>